<?xml version="1.0" encoding="UTF-8"?>
<!-- 引入命名空间所对应的Schema文件 -->
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:ldap="http://www.springframework.org/schema/ldap"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans-3.2.xsd
        http://www.springframework.org/schema/ldap
        http://www.springframework.org/schema/ldap/spring-ldap.xsd">

    <bean id="placeholderConfig" class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
        <property name="location" value="classpath:/test-ldap.properties"/>
    </bean>

    <ldap:context-source id="contextSource"
                         password="${sample.ldap.password}"
                         url="${sample.ldap.url}"
                         username="${sample.ldap.username}"
                         base="${sample.ldap.base}"/>

    <!-- 用初始数据填充LDAP服务器 -->
    <bean class="org.springframework.ldap.test.LdifPopulator" depends-on="embeddedLdapServer">
        <property name="contextSource" ref="contextSource"/>
        <property name="resource" value="classpath:/test-setup_data.ldif"/>
        <property name="base" value="${sample.ldap.base}"/>
        <property name="clean" value="${sample.ldap.clean}"/>
        <property name="defaultBase" value="${sample.ldap.defaultBase}"/>
    </bean>

    <!--仅仅测试与演示目的 -->
    <bean id="embeddedLdapServer" class="org.springframework.ldap.test.EmbeddedLdapServerFactoryBean">
        <property name="partitionName" value="example"/>
        <property name="partitionSuffix" value="${sample.ldap.base}"/>
        <property name="port" value="${sample.ldap.port}"/>
    </bean>

    <bean id="ldapTemplate" class="org.springframework.ldap.core.LdapTemplate">
        <constructor-arg ref="contextSource"/>
    </bean>

    <bean id="personDao" class="cn.mypandora.ldap.dao.PersonDaoImpl">
        <property name="ldapTemplate" ref="ldapTemplate"/>
    </bean>

    <bean class="cn.mypandora.ldap.utils.LdapTreeBuilder">
        <constructor-arg ref="ldapTemplate"/>
    </bean>
</beans>